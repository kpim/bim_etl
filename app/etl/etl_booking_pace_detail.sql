/* ------------------------------------------------------------------------------------
-- Tổng hợp dữ liệu từ nhiều bảng thành 1 bảng
*/
INSERT INTO dbo.booking_pace_detail
SELECT REPORT_DATE, FORMAT( DATEADD(DAY, 1, ARR), 'yyyy-MM') AS STAY_MONTH, PROPERTY, 
ARR AS ARRIVAL, DEP AS DEPARTURE, DATEADD(DAY, 1, ARR) AS STAYING, CREATED_DATE, 
MARKET_CODE AS MARKET, RATE_CODE, NULL AS RATE_AMT, 
ISNULL(NULL, 0) + ISNULL(ROOM_REVENUE, 0) + ISNULL(FOOD_REVENUE, 0) + ISNULL(OTHER_REVENUE, 0) AS TOTAL_TURN_OVER,
NULL AS ARR, ROOM_REVENUE AS ROOM_REV, FOOD_REVENUE AS FB_REV, OTHER_REVENUE AS OTHER_REV, 
NULL AS STATUS, NULL AS R_TYPE, NULL AS R_CHARGE, 
NO_ROOMS AS N_OF_ROOM, ADULTS AS N_OF_ADT, CHILDREN AS N_OF_CHD,
SOURCE_CODE AS BK_SOURCE, COUNTRY, COUNTRY AS NATIONALITY
FROM stg.booking_pace_p1
UNION ALL
SELECT REPORT_DATE, FORMAT(STAYING, 'yyyy-MM') AS STAY_MONTH, PROPERTY, 
ARRIVAL, DEPARTURE, STAYING, CONVERT(DATE, CREATE_TIME) AS CREATE_DATE,
MARKET, RATE_CODE, RATE_AMT, 
ISNULL(ARR, 0) + ISNULL(ROOM_REV, 0) + ISNULL(FB_REV, 0) + ISNULL(OTHER_REV, 0) AS TOTAL_TURN_OVER, 
ARR, ROOM_REV, FB_REV, OTHER_REV,
[STATUS], R_TYPE, R_CHARGE,
N_OF_ROOM, N_OF_ADT, N_OF_CHD, 
BK_SOURCE, COUNTRY, NATIONALITY
FROM stg.booking_pace_p2
UNION ALL
SELECT REPORT_DATE, FORMAT(STAYING, 'yyyy-MM') AS STAY_MONTH, PROPERTY,
ARRIVAL, DEPARTURE, STAYING, CONVERT(DATE, CREATE_TIME) AS CREATE_DATE,
MARKET, RATE_CODE, RATE_AMT, 
ISNULL(ARR, 0) + ISNULL(ROOM_REV, 0) + ISNULL(FB_REV, 0) + ISNULL(OTHER_REV, 0) AS TOTAL_TURN_OVER,
ARR, ROOM_REV, FB_REV, OTHER_REV,
[STATUS], R_TYPE, R_CHARGE,
N_OF_ROOM, N_OF_ADT, N_OF_CHD,
BK_SOURCE, COUNTRY, NATIONALITY
FROM stg.booking_pace_p3
ORDER BY REPORT_DATE, PROPERTY

SELECT REPORT_DATE, PROPERTY, COUNT(*) AS NB_ROWS
FROM dbo.booking_pace_report
GROUP BY REPORT_DATE, PROPERTY
ORDER BY REPORT_DATE, PROPERTY

SELECT REPORT_DATE, PROPERTY, COUNT(*) AS NB_ROWS
FROM dbo.booking_pace_sample_data
GROUP BY REPORT_DATE, PROPERTY
ORDER BY REPORT_DATE, PROPERTY

SELECT COUNT(*)
FROM dbo.booking_pace_sample_data
WHERE REPORT_DATE = '2023-05-01'

SELECT *
FROM dbo.booking_pace_sample_data
WHERE REPORT_DATE = '2023-05-01'
ORDER BY REPORT_DATE
OFFSET 84940 ROWS 
FETCH NEXT 2 ROWS ONLY;

/*
Dec-24	Syrena Cruises	 31/12/2024	 02/01/2025	 31/12/2024	 27/11/2024	CW	WS2N	10.000.000	8.818.342	8.818.342	7.675.485	1.142.857	0	Definite	CV2F	SV3A	1	6	0	TO	KOR	KOR
Dec-24	Syrena Cruises	 31/12/2024	 01/01/2025	 31/12/2024	 01/12/2024	TI	IRB1	13.564.800	11.961.905	11.961.905	11.390.476	571.429	0	Definite	SV3A	SV3A	1	2	0	OTA	KOR	KOR
Dec-24	Syrena Cruises	 31/12/2024	 01/01/2025	 31/12/2024	 05/12/2024	TI	IRB1	7.974.000	11.222.224	11.222.224	5.994.709	835.979	4.391.536	Definite	PV3B	SV1F	1	2	0	OTA	CHN	CHN
Dec-24	Syrena Cruises	 31/12/2024	 01/01/2025	 31/12/2024	 16/12/2024	CW	WS2N	7.840.000	6.913.580	6.913.580	6.342.151	571.429	0	Definite	SV3A	CV2E	1	4	0	TO	CHN	CHN
*/
